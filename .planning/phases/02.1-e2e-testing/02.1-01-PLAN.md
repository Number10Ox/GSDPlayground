---
phase: 02.1-e2e-testing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - playwright.config.ts
  - e2e/fixtures/base.ts
autonomous: true

must_haves:
  truths:
    - "npm run test:e2e executes Playwright tests"
    - "Tests run in headless mode by default"
    - "Tests can target localhost:5173"
  artifacts:
    - path: "playwright.config.ts"
      provides: "Playwright configuration"
      contains: "defineConfig"
    - path: "e2e/fixtures/base.ts"
      provides: "Shared test fixtures"
      exports: ["test", "expect"]
    - path: "package.json"
      provides: "test:e2e script"
      contains: "test:e2e"
  key_links:
    - from: "package.json"
      to: "playwright.config.ts"
      via: "npm script invokes playwright"
      pattern: "playwright test"
    - from: "e2e/fixtures/base.ts"
      to: "playwright.config.ts"
      via: "fixture extends base config"
      pattern: "@playwright/test"
---

<objective>
Install and configure Playwright for browser-based E2E testing with BDD support.

Purpose: Establish testing infrastructure that validates gameplay flows before shipping
Output: Working Playwright setup with npm scripts and CI-ready configuration
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 2 summary - understanding what we're testing
@.planning/phases/02-cycle-system/02-04-SUMMARY.md

# Current project structure
@package.json
@vite.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Playwright and create configuration</name>
  <files>package.json, playwright.config.ts</files>
  <action>
Install Playwright as dev dependency:
```bash
npm install -D @playwright/test
npx playwright install chromium
```

Create playwright.config.ts at project root with:
- baseURL: 'http://localhost:5173' (Vite dev server)
- testDir: './e2e'
- timeout: 30000ms per test
- retries: 0 in dev, 2 in CI (detect via process.env.CI)
- reporter: 'html' for dev, 'github' + 'html' for CI
- use.headless: true (default)
- use.trace: 'on-first-retry' for debugging failures
- webServer config to start Vite dev server automatically:
  - command: 'npm run dev'
  - url: 'http://localhost:5173'
  - reuseExistingServer: !process.env.CI

Projects array with single 'chromium' project for now (keep simple, add browsers later if needed).

Do NOT use deprecated options (no `channel: 'chrome'`, stick with bundled chromium).
  </action>
  <verify>
```bash
npx playwright --version
cat playwright.config.ts
```
Both should succeed - Playwright installed and config file exists.
  </verify>
  <done>Playwright installed, playwright.config.ts exists with correct webServer config pointing to localhost:5173</done>
</task>

<task type="auto">
  <name>Task 2: Create base test fixtures and npm scripts</name>
  <files>e2e/fixtures/base.ts, package.json</files>
  <action>
Create e2e/fixtures/base.ts that re-exports Playwright's test and expect with extended fixtures:
```typescript
import { test as base, expect } from '@playwright/test';

// Extend base test with app-specific fixtures
export const test = base.extend<{
  // Future: add game state fixtures here
}>({
  // Placeholder for game fixtures
});

export { expect };
```

Add npm scripts to package.json:
- "test:e2e": "playwright test"
- "test:e2e:ui": "playwright test --ui"
- "test:e2e:headed": "playwright test --headed"
- "test:e2e:debug": "playwright test --debug"

Create e2e/.gitkeep or a placeholder test file e2e/example.spec.ts:
```typescript
import { test, expect } from './fixtures/base';

test('app loads', async ({ page }) => {
  await page.goto('/');
  await expect(page).toHaveTitle(/Dogs in the Vineyard|Vite/);
});
```
  </action>
  <verify>
```bash
npm run test:e2e
```
Should start dev server, run the example test, and pass.
  </verify>
  <done>npm run test:e2e executes successfully, example test passes</done>
</task>

<task type="auto">
  <name>Task 3: Add data-testid attributes to key UI elements</name>
  <files>src/components/CycleView/CycleView.tsx</files>
  <action>
Add data-testid attributes to CycleView.tsx for E2E test targeting:

WAKE phase:
- data-testid="cycle-wake-overlay" on container div
- data-testid="day-number" on the Day X heading (also add a data-day="{cycleNumber}" attribute)
- data-testid="start-day-button" on Start Day button

ALLOCATE phase:
- data-testid="action-panel" on the action panel container
- data-testid="dice-pool" on the dice pool container
- data-testid="confirm-allocations-button" on Confirm button
- data-testid="rest-early-button" on Rest Early button

SUMMARY phase:
- Already handled in CycleSummary component (check if needs testids)

REST phase:
- data-testid="cycle-rest-overlay" on container
- data-testid="next-day-button" on Next Day button

Keep existing class names and structure - only add data-testid attributes.
  </action>
  <verify>
```bash
grep -r "data-testid" src/components/CycleView/
```
Should show testid attributes on key elements.
  </verify>
  <done>CycleView has data-testid attributes on all interactive elements</done>
</task>

</tasks>

<verification>
Run the full verification suite:

```bash
# Playwright installed
npx playwright --version

# Config exists
test -f playwright.config.ts && echo "Config exists"

# Scripts work
npm run test:e2e

# testids in place
grep -c "data-testid" src/components/CycleView/CycleView.tsx
```

All checks should pass.
</verification>

<success_criteria>
1. Playwright installed as devDependency
2. playwright.config.ts configured for localhost:5173 with webServer
3. npm run test:e2e starts dev server and runs tests
4. Base fixtures exported from e2e/fixtures/base.ts
5. CycleView.tsx has data-testid on key elements
6. Example test passes
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-e2e-testing/02.1-01-SUMMARY.md`
</output>
