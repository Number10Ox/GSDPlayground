---
phase: 02-cycle-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/game.ts
  - src/utils/dice.ts
  - src/components/DicePool/DicePool.tsx
  - src/components/DicePool/DieComponent.tsx
  - src/components/DicePool/DieIcon.tsx
  - src/components/DicePool/index.ts
autonomous: true

must_haves:
  truths:
    - "Player can see their dice pool with individual die values"
    - "Dice are visually distinct by type (d4, d6, d8, d10)"
    - "Dice pool is keyboard navigable"
  artifacts:
    - path: "src/types/game.ts"
      provides: "Die, DieType, CyclePhase type definitions"
      contains: "DieType.*d4.*d6.*d8.*d10"
    - path: "src/utils/dice.ts"
      provides: "Dice rolling and pool generation"
      exports: ["rollDie", "generateDicePool"]
    - path: "src/components/DicePool/DicePool.tsx"
      provides: "Dice pool container with keyboard navigation"
      min_lines: 40
    - path: "src/components/DicePool/DieIcon.tsx"
      provides: "SVG die shapes for each type"
      contains: "d4.*d6.*d8.*d10"
  key_links:
    - from: "src/components/DicePool/DicePool.tsx"
      to: "src/types/game.ts"
      via: "Die type import"
      pattern: "import.*Die.*from.*types/game"
    - from: "src/components/DicePool/DieComponent.tsx"
      to: "src/components/DicePool/DieIcon.tsx"
      via: "SVG icon render"
      pattern: "DieIcon"
---

<objective>
Add cycle-related type definitions and build the dice pool visualization with DitV-faithful polyhedral dice.

Purpose: Establishes the visual foundation for dice allocation - players need to see their dice before deciding how to use them. This is the core of the Citizen Sleeper-inspired loop.
Output: Types for dice/cycles and a keyboard-accessible dice pool component showing rolled dice values.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-cycle-system/02-CONTEXT.md
@.planning/phases/02-cycle-system/02-RESEARCH.md

# Existing codebase
@src/types/game.ts
@src/hooks/useGameState.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend type definitions for dice and cycles</name>
  <files>src/types/game.ts, src/utils/dice.ts</files>
  <action>
    Extend src/types/game.ts with cycle-related types:

    ```typescript
    // Dice types (DitV polyhedral)
    export type DieType = 'd4' | 'd6' | 'd8' | 'd10';

    export interface Die {
      id: string;
      type: DieType;
      value: number;        // Rolled value (1-max based on type)
      assignedTo: string | null;  // Action ID or null if in pool
    }

    // Cycle phases (Citizen Sleeper-inspired)
    export type CyclePhase = 'WAKE' | 'ALLOCATE' | 'RESOLVE' | 'SUMMARY' | 'REST';
    ```

    Create src/utils/dice.ts with dice utilities:

    ```typescript
    export function rollDie(type: DieType): number {
      const max = parseInt(type.slice(1)); // 'd6' -> 6
      return Math.floor(Math.random() * max) + 1;
    }

    export function generateDicePool(condition: number): Die[] {
      // condition 0-100 maps to 1-5 dice
      // Better condition = more d6s/d8s, worse = more d4s
      // Generate unique IDs with crypto.randomUUID() or Date.now() fallback
    }

    export function getDieMax(type: DieType): number {
      return parseInt(type.slice(1));
    }
    ```
  </action>
  <verify>TypeScript compiles: `npm run build` passes with no type errors</verify>
  <done>Die and DieType types exported, rollDie and generateDicePool functions work correctly</done>
</task>

<task type="auto">
  <name>Task 2: Create SVG die icon component</name>
  <files>src/components/DicePool/DieIcon.tsx</files>
  <action>
    Create DieIcon component that renders 2D SVG shapes for each die type:

    - d4: Triangle (red-ish, weakest)
    - d6: Square (amber, standard)
    - d8: Diamond/rhombus (green, good)
    - d10: Pentagon-ish (blue, best)

    Props: type (DieType), value (number), size ('sm' | 'md' | 'lg')

    Use distinct fill colors per die type for quick visual recognition.
    Display the rolled value as centered text inside the shape.
    Use Tailwind colors that work on dark backgrounds.

    Size mapping: sm=32px, md=48px, lg=64px

    Do NOT use external icon libraries - custom SVG paths only.
  </action>
  <verify>Visual check: Import DieIcon in App.tsx temporarily, render all 4 types, confirm shapes render correctly</verify>
  <done>DieIcon renders distinct shapes for d4/d6/d8/d10 with value overlay</done>
</task>

<task type="auto">
  <name>Task 3: Build DicePool container with keyboard navigation</name>
  <files>src/components/DicePool/DicePool.tsx, src/components/DicePool/DieComponent.tsx, src/components/DicePool/index.ts</files>
  <action>
    Create DieComponent wrapper that handles selection state:
    - Uses DieIcon for visual
    - Shows selection state (scale-110, ring-2, ring-amber-400 when selected)
    - Shows focus state with focus-visible:ring-2
    - onClick calls onSelect prop
    - aria-pressed for selected state
    - aria-label describing die type and value

    Create DicePool container with ARIA listbox pattern:
    - role="listbox" with aria-label="Dice pool"
    - Arrow keys (left/right) navigate between dice
    - Enter/Space selects focused die
    - aria-activedescendant tracks focused die
    - Single tab stop for entire pool (tabIndex={0} on container)
    - Horizontal flex layout with gap-2
    - Dark surface background (bg-surface rounded-lg p-4)

    Props for DicePool:
    - dice: Die[]
    - selectedDieId: string | null
    - onSelect: (dieId: string) => void

    Create index.ts barrel export for DicePool and DieComponent.

    Use Framer Motion's motion.button with layoutId={die.id} on DieComponent for future animation support (dice will animate to actions in Plan 04).
  </action>
  <verify>
    1. TypeScript compiles: `npm run build`
    2. Accessibility: Tab to pool, arrow keys move focus, Enter selects, selected die has visual ring
  </verify>
  <done>DicePool renders dice with keyboard navigation, selection works via click and keyboard</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Types exported: Die, DieType, CyclePhase from game.ts
3. Functions exported: rollDie, generateDicePool from utils/dice.ts
4. DicePool renders with sample dice, keyboard navigation works
5. Visual: Each die type has distinct shape and color
</verification>

<success_criteria>
- Player can see a horizontal tray of dice with distinct visual shapes
- Each die shows its rolled value
- Keyboard users can navigate and select dice
- Foundation types ready for cycle state machine (Plan 03)
</success_criteria>

<output>
After completion, create `.planning/phases/02-cycle-system/02-01-SUMMARY.md`
</output>
