---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/App.tsx
  - src/types/game.ts
  - src/hooks/useGameState.tsx
  - src/pages/GameView.tsx
  - src/components/NodeMap/NodeMap.tsx
  - src/components/NodeMap/LocationNode.tsx
  - src/components/NarrativePanel/NarrativePanel.tsx
  - src/components/CharacterInfo/CharacterInfo.tsx
  - src/components/ui/NarrativeText.tsx
autonomous: true

must_haves:
  truths:
    - "User sees multi-pane layout with node map in main area and sidebar on right"
    - "User can click a location node and see the narrative panel slide in"
    - "User can close the narrative panel"
    - "Current location is visually highlighted on the node map"
    - "Text in narrative panel is readable at 28px minimum"
    - "Minimal character stats visible in sidebar"
  artifacts:
    - path: "src/pages/GameView.tsx"
      provides: "Main dashboard layout with CSS Grid"
      min_lines: 20
    - path: "src/components/NodeMap/NodeMap.tsx"
      provides: "Interactive SVG town map with clickable nodes"
      exports: ["NodeMap"]
    - path: "src/components/NarrativePanel/NarrativePanel.tsx"
      provides: "Sliding panel with AnimatePresence"
      exports: ["NarrativePanel"]
    - path: "src/components/CharacterInfo/CharacterInfo.tsx"
      provides: "Sidebar with minimal stats display"
      exports: ["CharacterInfo"]
    - path: "src/hooks/useGameState.tsx"
      provides: "Game state context and provider"
      exports: ["useGameState", "GameProvider"]
    - path: "src/types/game.ts"
      provides: "TypeScript definitions for game entities"
      contains: "Location"
  key_links:
    - from: "src/pages/GameView.tsx"
      to: "src/hooks/useGameState.tsx"
      via: "Context consumption"
      pattern: "useGameState"
    - from: "src/components/NodeMap/NodeMap.tsx"
      to: "src/hooks/useGameState.tsx"
      via: "dispatch NAVIGATE action"
      pattern: "dispatch.*NAVIGATE"
    - from: "src/components/NarrativePanel/NarrativePanel.tsx"
      to: "framer-motion"
      via: "AnimatePresence for slide animation"
      pattern: "AnimatePresence"
---

<objective>
Build the core UI shell with multi-pane layout, interactive node map, and sliding narrative panel.

Purpose: Deliver the visual foundation that players will see and interact with - the Citizen Sleeper-style dashboard with atmospheric presentation.
Output: A functional UI where users can click locations on a town map and see narrative content appear in a sliding panel.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create type definitions and game state context</name>
  <files>
    src/types/game.ts
    src/hooks/useGameState.tsx
  </files>
  <action>
    Create src/types/game.ts with foundational type definitions:
    ```typescript
    export type LocationId = string;

    export interface Location {
      id: LocationId;
      name: string;
      description: string;
      x: number;  // SVG coordinate (0-1000 range)
      y: number;  // SVG coordinate (0-800 range)
      connections: LocationId[];  // IDs of connected locations
    }

    export interface Scene {
      id: string;
      locationId: LocationId;
      title: string;
      text: string;
    }

    export interface GameState {
      currentLocation: LocationId;
      isPanelOpen: boolean;
      currentScene: Scene | null;
      locations: Location[];
    }

    export type GameAction =
      | { type: 'NAVIGATE'; locationId: LocationId }
      | { type: 'OPEN_PANEL'; scene: Scene }
      | { type: 'CLOSE_PANEL' };
    ```

    Create src/hooks/useGameState.tsx with Context + useReducer:
    ```typescript
    import { createContext, useContext, useReducer, type ReactNode, type Dispatch } from 'react';
    import type { GameState, GameAction, Location } from '@/types/game';

    // Sample town data for Phase 1 (will be procedurally generated later)
    const SAMPLE_LOCATIONS: Location[] = [
      { id: 'town-square', name: 'Town Square', description: 'The heart of Bridal Falls', x: 500, y: 400, connections: ['church', 'general-store', 'sheriffs-office'] },
      { id: 'church', name: 'The Chapel', description: 'A modest house of worship', x: 500, y: 200, connections: ['town-square', 'cemetery'] },
      { id: 'general-store', name: 'General Store', description: 'Ezekiel runs the store', x: 300, y: 400, connections: ['town-square'] },
      { id: 'sheriffs-office', name: "Sheriff's Office", description: 'Law in Bridal Falls', x: 700, y: 400, connections: ['town-square'] },
      { id: 'cemetery', name: 'Cemetery', description: 'The town buries its dead here', x: 500, y: 50, connections: ['church'] },
    ];

    const initialState: GameState = {
      currentLocation: 'town-square',
      isPanelOpen: false,
      currentScene: null,
      locations: SAMPLE_LOCATIONS,
    };

    function gameReducer(state: GameState, action: GameAction): GameState {
      switch (action.type) {
        case 'NAVIGATE': {
          const location = state.locations.find(l => l.id === action.locationId);
          if (!location) return state;
          return {
            ...state,
            currentLocation: action.locationId,
            isPanelOpen: true,
            currentScene: {
              id: `scene-${action.locationId}`,
              locationId: action.locationId,
              title: location.name,
              text: location.description,
            },
          };
        }
        case 'OPEN_PANEL':
          return { ...state, isPanelOpen: true, currentScene: action.scene };
        case 'CLOSE_PANEL':
          return { ...state, isPanelOpen: false };
        default:
          return state;
      }
    }

    const GameContext = createContext<{
      state: GameState;
      dispatch: Dispatch<GameAction>;
    } | null>(null);

    export function GameProvider({ children }: { children: ReactNode }) {
      const [state, dispatch] = useReducer(gameReducer, initialState);
      return (
        <GameContext.Provider value={{ state, dispatch }}>
          {children}
        </GameContext.Provider>
      );
    }

    export function useGameState() {
      const context = useContext(GameContext);
      if (!context) {
        throw new Error('useGameState must be used within a GameProvider');
      }
      return context;
    }
    ```

    Note: Use explicit React imports (not React.createContext) for tree-shaking.
  </action>
  <verify>
    - Run `npx tsc --noEmit` - no TypeScript errors
    - Types are properly exported from game.ts
    - useGameState hook throws meaningful error if used outside provider
  </verify>
  <done>
    Type definitions created, GameContext and useGameState hook working with sample location data
  </done>
</task>

<task type="auto">
  <name>Task 2: Build the multi-pane GameView layout and components</name>
  <files>
    src/pages/GameView.tsx
    src/components/NodeMap/NodeMap.tsx
    src/components/NodeMap/LocationNode.tsx
    src/components/NarrativePanel/NarrativePanel.tsx
    src/components/CharacterInfo/CharacterInfo.tsx
    src/components/ui/NarrativeText.tsx
  </files>
  <action>
    Create src/components/ui/NarrativeText.tsx for consistent text styling:
    ```typescript
    import type { ReactNode } from 'react';

    interface NarrativeTextProps {
      children: ReactNode;
      className?: string;
    }

    export function NarrativeText({ children, className = '' }: NarrativeTextProps) {
      return (
        <p className={`text-narrative leading-relaxed max-w-prose text-gray-100 ${className}`}>
          {children}
        </p>
      );
    }
    ```

    Create src/components/NodeMap/LocationNode.tsx:
    ```typescript
    import type { Location } from '@/types/game';

    interface LocationNodeProps {
      location: Location;
      isCurrentLocation: boolean;
      onClick: () => void;
    }

    export function LocationNode({ location, isCurrentLocation, onClick }: LocationNodeProps) {
      return (
        <g
          onClick={onClick}
          className="cursor-pointer"
          role="button"
          tabIndex={0}
          onKeyDown={(e) => e.key === 'Enter' && onClick()}
        >
          <circle
            cx={location.x}
            cy={location.y}
            r={isCurrentLocation ? 35 : 30}
            className={`transition-all duration-200 ${
              isCurrentLocation
                ? 'fill-amber-500 stroke-amber-300 stroke-2'
                : 'fill-surface-light hover:fill-surface stroke-gray-600 stroke-1 hover:stroke-gray-400'
            }`}
          />
          <text
            x={location.x}
            y={location.y + 55}
            textAnchor="middle"
            className={`text-sm fill-current ${isCurrentLocation ? 'text-amber-200' : 'text-gray-400'}`}
          >
            {location.name}
          </text>
        </g>
      );
    }
    ```

    Create src/components/NodeMap/NodeMap.tsx:
    ```typescript
    import { useGameState } from '@/hooks/useGameState';
    import { LocationNode } from './LocationNode';

    export function NodeMap() {
      const { state, dispatch } = useGameState();
      const { locations, currentLocation } = state;

      // Build connection lines between locations
      const connections: Array<{ from: { x: number; y: number }; to: { x: number; y: number }; key: string }> = [];
      const processedPairs = new Set<string>();

      locations.forEach(loc => {
        loc.connections.forEach(connId => {
          const pairKey = [loc.id, connId].sort().join('-');
          if (!processedPairs.has(pairKey)) {
            processedPairs.add(pairKey);
            const connLoc = locations.find(l => l.id === connId);
            if (connLoc) {
              connections.push({
                from: { x: loc.x, y: loc.y },
                to: { x: connLoc.x, y: connLoc.y },
                key: pairKey,
              });
            }
          }
        });
      });

      return (
        <svg
          viewBox="0 0 1000 500"
          className="w-full h-full"
          role="img"
          aria-label="Town map with navigable locations"
        >
          {/* Connection lines */}
          {connections.map(conn => (
            <line
              key={conn.key}
              x1={conn.from.x}
              y1={conn.from.y}
              x2={conn.to.x}
              y2={conn.to.y}
              className="stroke-gray-700 stroke-2"
            />
          ))}

          {/* Location nodes */}
          {locations.map(loc => (
            <LocationNode
              key={loc.id}
              location={loc}
              isCurrentLocation={loc.id === currentLocation}
              onClick={() => dispatch({ type: 'NAVIGATE', locationId: loc.id })}
            />
          ))}
        </svg>
      );
    }
    ```

    Create src/components/NarrativePanel/NarrativePanel.tsx:
    ```typescript
    import { motion, AnimatePresence } from 'framer-motion';
    import { useGameState } from '@/hooks/useGameState';
    import { NarrativeText } from '@/components/ui/NarrativeText';

    export function NarrativePanel() {
      const { state, dispatch } = useGameState();
      const { isPanelOpen, currentScene } = state;

      return (
        <AnimatePresence>
          {isPanelOpen && currentScene && (
            <motion.div
              className="absolute bottom-0 left-0 right-0 bg-surface/95 backdrop-blur-sm border-t border-gray-700"
              initial={{ y: '100%' }}
              animate={{ y: 0 }}
              exit={{ y: '100%' }}
              transition={{ type: 'spring', damping: 25, stiffness: 200 }}
            >
              <div className="p-8 max-w-4xl mx-auto">
                <div className="flex justify-between items-start mb-4">
                  <h2 className="text-2xl font-semibold text-gray-100">
                    {currentScene.title}
                  </h2>
                  <button
                    onClick={() => dispatch({ type: 'CLOSE_PANEL' })}
                    className="text-gray-400 hover:text-gray-200 transition-colors p-2"
                    aria-label="Close panel"
                  >
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
                <NarrativeText>{currentScene.text}</NarrativeText>
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      );
    }
    ```

    Create src/components/CharacterInfo/CharacterInfo.tsx:
    ```typescript
    export function CharacterInfo() {
      // Placeholder data - will be connected to character system in Phase 4
      return (
        <div className="bg-surface rounded-lg p-4 space-y-4">
          <h3 className="text-lg font-semibold text-gray-100 border-b border-gray-700 pb-2">
            Your Dog
          </h3>

          {/* Minimal stats - always visible */}
          <div className="space-y-3">
            <div className="flex justify-between items-center">
              <span className="text-gray-400 text-sm">Cycle</span>
              <span className="text-amber-400 font-medium">Day 1</span>
            </div>

            <div className="flex justify-between items-center">
              <span className="text-gray-400 text-sm">Dice Pool</span>
              <span className="text-gray-100 font-medium">4d6</span>
            </div>

            <div className="flex justify-between items-center">
              <span className="text-gray-400 text-sm">Fallout</span>
              <span className="text-green-400 font-medium">None</span>
            </div>
          </div>

          {/* View full sheet link */}
          <button className="w-full text-sm text-gray-400 hover:text-gray-200 transition-colors pt-2 border-t border-gray-700">
            View Character Sheet
          </button>
        </div>
      );
    }
    ```

    Create src/pages/GameView.tsx:
    ```typescript
    import { NodeMap } from '@/components/NodeMap/NodeMap';
    import { NarrativePanel } from '@/components/NarrativePanel/NarrativePanel';
    import { CharacterInfo } from '@/components/CharacterInfo/CharacterInfo';

    export function GameView() {
      return (
        <div className="grid grid-cols-[1fr_280px] h-screen gap-4 p-4 bg-background">
          {/* Main area: node map + narrative panel */}
          <main className="relative overflow-hidden bg-surface rounded-lg">
            <div className="absolute inset-0 flex items-center justify-center">
              <NodeMap />
            </div>
            <NarrativePanel />
          </main>

          {/* Sidebar: character info */}
          <aside className="flex flex-col gap-4">
            <CharacterInfo />

            {/* Location info card */}
            <div className="bg-surface rounded-lg p-4 flex-1">
              <h3 className="text-lg font-semibold text-gray-100 border-b border-gray-700 pb-2 mb-4">
                Bridal Falls
              </h3>
              <p className="text-sm text-gray-400">
                A small town nestled in the mountains. Something feels wrong here.
              </p>
            </div>
          </aside>
        </div>
      );
    }
    ```
  </action>
  <verify>
    - Run `npx tsc --noEmit` - no TypeScript errors
    - All components export correctly
    - Framer Motion imports work without errors
  </verify>
  <done>
    All UI components created with proper TypeScript types and Tailwind styling
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire up App.tsx and verify interactive UI</name>
  <files>
    src/App.tsx
  </files>
  <action>
    Update src/App.tsx to use the GameProvider and GameView:
    ```typescript
    import { GameProvider } from '@/hooks/useGameState';
    import { GameView } from '@/pages/GameView';

    function App() {
      return (
        <GameProvider>
          <GameView />
        </GameProvider>
      );
    }

    export default App;
    ```

    Verify the full interaction flow works:
    1. App loads with Town Square as current location (amber highlight)
    2. Click any location node
    3. Narrative panel slides up from bottom
    4. Panel shows location name and description
    5. Click X button to close panel
    6. Current location updates to clicked location

    If path aliases don't resolve, check that tsconfig.json has the paths configured correctly and vite.config.ts has the alias.
  </action>
  <verify>
    - Run `npm run dev`
    - Browser shows node map with 5 locations
    - Town Square highlighted in amber
    - Click "The Chapel" - panel slides up with "The Chapel" title
    - Click X - panel slides down
    - Text in panel is 28px (text-narrative class)
    - Sidebar shows "Your Dog" card with Cycle, Dice Pool, Fallout
  </verify>
  <done>
    Complete UI shell working: node map navigation, sliding narrative panel, character info sidebar
  </done>
</task>

</tasks>

<verification>
Run these checks to verify the plan is complete:

1. **TypeScript compilation:**
   ```bash
   npx tsc --noEmit
   # Should complete with no errors
   ```

2. **Visual verification in browser:**
   - Layout: Main area (map) on left, sidebar on right
   - Node map: 5 locations visible, connected by lines
   - Current location: Amber highlight
   - Click interaction: Panel slides up smoothly
   - Close button: Panel slides down smoothly
   - Text size: Narrative text is clearly readable (28px)

3. **Production build:**
   ```bash
   npm run build
   # Should complete without errors
   ```

4. **Console check:**
   - No React errors or warnings in browser console
   - No TypeScript runtime errors
</verification>

<success_criteria>
- Multi-pane dashboard layout renders correctly (map area + sidebar)
- Interactive SVG node map displays town locations
- Clicking a location opens the narrative panel with smooth animation
- Narrative panel can be closed
- Current location is visually distinguished (amber highlight)
- Text meets 28px minimum size requirement
- Sidebar displays minimal character stats (placeholder data)
- No TypeScript errors, no console errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
