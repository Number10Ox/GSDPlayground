---
phase: 06.2-e2e-test-overhaul
plan: 03
subsystem: testing
tags: [playwright, e2e, journey, conviction, reflection, multi-town]

# Dependency graph
requires:
  - phase: 06.2-01
    provides: fixed E2E step helpers for character creation and dialogue
provides:
  - E2E coverage for journey flow (town completion, conviction reflection, multi-town progression)
  - Dev-mode buttons for triggering conviction tests and town completion
  - Reusable journey step helpers for future tests
affects: [06.2-04, 06.2-05]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Dev-mode buttons for journey phase transitions (dev-trigger-test-conviction, dev-complete-town)"
    - "Journey step helpers as reusable functions matching existing step pattern"

key-files:
  created:
    - e2e/steps/journey.steps.ts
    - e2e/journey.spec.ts
  modified:
    - src/pages/GameView.tsx

key-decisions:
  - "Dev-mode buttons over direct reducer manipulation for E2E journey triggers (consistent with existing pattern)"
  - "CompleteTown dispatches both COMPLETE_TOWN and SET_PHASE in sequence (matching ResolutionSummary behavior)"
  - "Test conviction button tests first active conviction with conflict_outcome trigger"

patterns-established:
  - "Journey E2E: trigger conviction test via dev button, complete town via dev button, verify reflection/progress screens"
  - "Dev button naming: dev-{action} data-testid pattern for test-only UI triggers"

# Metrics
duration: 4min
completed: 2026-01-24
---

# Phase 6.2 Plan 03: Journey Flow E2E Summary

**E2E coverage for journey flow: conviction testing, reflection (reinforce/doubt/untested), JourneyProgress screen, and multi-town progression via dev-mode triggers**

## Performance

- **Duration:** 4 min
- **Started:** 2026-01-24T07:11:42Z
- **Completed:** 2026-01-24T07:15:25Z
- **Tasks:** 2
- **Files modified:** 3

## Accomplishments
- Journey step helpers covering full flow: triggerConvictionTest, completeTown, completeJudgment, waitForReflection, reinforceConviction, doubtConviction, transformConviction, skipUntested, waitForJourneyProgress, advanceToNextTown
- 5 E2E tests covering town completion, conviction reflection (reinforce and doubt), untested convictions skip, and JourneyProgress with multi-town continuation
- Dev-mode buttons in GameView for deterministic journey phase triggering
- Implicitly covers the f2e30c7 edge case (ConvictionReflection reading from completedTowns)

## Task Commits

Each task was committed atomically:

1. **Task 1: Create journey step helpers** - `b2051a0` (feat)
2. **Task 2: Journey flow E2E spec** - `477ace9` (feat)

## Files Created/Modified
- `e2e/steps/journey.steps.ts` - Reusable helpers for journey flow testing (10 exported functions)
- `e2e/journey.spec.ts` - 5 E2E tests covering the journey flow
- `src/pages/GameView.tsx` - Added dev-mode buttons for conviction testing and town completion

## Decisions Made
- Used dev-mode buttons (import.meta.env.DEV guard) rather than direct state manipulation, consistent with existing patterns (start-test-conflict, add-test-trait)
- CompleteTown dev button dispatches both COMPLETE_TOWN and SET_PHASE: TOWN_REFLECTION in sequence, matching the ResolutionSummary "Ride On" behavior exactly
- Test conviction button uses conflict_outcome trigger type with PLAYER_WON outcome to test first active conviction

## Deviations from Plan

None - plan executed exactly as written. The plan noted that if GameView didn't have dev-mode judgment triggers, to add them. Both dev-trigger-test-conviction and dev-complete-town buttons were added as specified.

## Issues Encountered
None - all 5 tests passed on first run, and all 52 tests in the full suite pass without regressions.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Journey flow fully covered by E2E tests
- Step helpers available for reuse in future specs (06.2-04, 06.2-05)
- Total E2E suite: 52 tests, all passing

---
*Phase: 06.2-e2e-test-overhaul*
*Completed: 2026-01-24*
